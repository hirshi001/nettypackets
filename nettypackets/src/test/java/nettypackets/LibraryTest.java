/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package nettypackets;

import nettypackets.packet.PacketHolder;
import org.junit.Test;

public class LibraryTest {

    public static SidedPacketRegistryContainer serverPacketRegistries;
    public static PacketRegistry serverRegistry;


    public static SidedPacketRegistryContainer clientPacketRegistries;
    public static PacketRegistry clientRegistry;

    public static Server server;
    public static Client client;


    @Test
    public void test() {

        serverPacketRegistries = new SidedPacketRegistryContainer();
        serverRegistry = serverPacketRegistries.create("iogames");
        serverRegistry.register(new PacketHolder<>(TestPacket::new, TestPacket::serverHandle, TestPacket.class), 0);

        clientPacketRegistries = new SidedPacketRegistryContainer();
        clientRegistry = clientPacketRegistries.create("iogames");
        clientRegistry.register(new PacketHolder<>(TestPacket::new, TestPacket::clientHandle, TestPacket.class), 0);


        server = new Server(8080, serverPacketRegistries);
        Thread thread = new Thread(){
            @Override
            public void run() {
                try {
                    server.startUp();
                }catch(Exception ignored){}
            }
        };

        thread.start();

        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        client = new Client("localhost", 8080, clientPacketRegistries);
        thread = new Thread(){
            @Override
            public void run() {
                try {
                    client.run();
                }catch(Exception e){}
            }
        };
        thread.start();

        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        for(int i=0;i<10;i++){
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            client.sendPacket(clientRegistry, new TestPacket("hi"));
        }



    }
}
